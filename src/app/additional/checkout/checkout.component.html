<div class="container-fluid">
  <div class="row">
    <div class="col-md-9">
      <div class="card my-3 border-0">
        <div class="card-body">
          <h3 class="card-title mb-5 text-center">
            Checkout ({{ totalQuantity }} items)
          </h3>

          <div class="row">
            <div class="col-12">
              <span class="fw-bold">1 - Shipping address</span>
              <div class="form-check form-switch my-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="flexSwitchCheckDefault"
                  (click)="onAddNewAddress()"
                />
                <label class="form-check-label" for="flexSwitchCheckDefault"
                  >Add new shipping address?</label
                >
              </div>
              <form
                *ngIf="addNewShipping"
                #addressForm="ngForm"
                class="row g-3 mt-1"
              >
                <div class="w-50">
                  <label for="" class="form-label">Country:</label>
                  <input
                    required
                    #txtInputCountry="ngModel"
                    [(ngModel)]="addNewUserAddress.country"
                    type="text"
                    class="form-control"
                    name="country"
                    id="country"
                  />
                </div>
                <div class="w-50">
                  <label for="" class="form-label">City:</label>
                  <input
                    required
                    #txtInputCity="ngModel"
                    [(ngModel)]="addNewUserAddress.city"
                    type="text"
                    class="form-control"
                    name="city"
                    id="city"
                  />
                </div>
                <div class="w-50">
                  <label for="" class="form-label">State:</label>
                  <input
                    #txtInputState="ngModel"
                    [(ngModel)]="addNewUserAddress.state"
                    type="text"
                    class="form-control"
                    name="state"
                    id="state"
                  />
                </div>
                <div class="w-50">
                  <label for="" class="form-label">Postal Code:</label>
                  <input
                    #txtInputPostalCode="ngModel"
                    [(ngModel)]="addNewUserAddress.postalCode"
                    type="number"
                    class="form-control"
                    name="postalCode"
                    id="postalCode"
                  />
                </div>
                <div class="col-12">
                  <label for="" class="form-label">Street Details:</label>
                  <input
                    required
                    #txtInputStreet="ngModel"
                    [(ngModel)]="addNewUserAddress.street"
                    type="text"
                    class="form-control"
                    name="street"
                    id="street"
                  />
                </div>
                <div class="MM_subTotal">
                  <span class="me-2">Save Address?</span>
                  <button
                    style="vertical-align: baseline"
                    (click)="onAddUserAddress(addressForm)"
                    type="submit"
                    class="btn bg-gradient p-1 px-3 mb-3"
                    [disabled]="addressForm.invalid"
                  >
                    Yes
                  </button>
                </div>
              </form>
              <p class="fw-bold mt-3">Select shipping address:</p>
              <div class="form-check w-75">
                <div
                  class="media border p-5 mb-3"
                  *ngFor="let address of addresses"
                >
                  <input
                    class="form-check-input"
                    (change)="onCheckAddress()"
                    [(ngModel)]="selectedAddress"
                    [value]="address"
                    type="radio"
                    id="address"
                  />
                  <label class="form-check-label" for="">
                    <div class="media-body">
                      <div>
                        <span class="fw-bold" style="font-size: 0.8rem"
                          >Country:</span
                        >
                        {{ address.country }}
                      </div>
                      <div>
                        <span class="fw-bold" style="font-size: 0.8rem"
                          >City:</span
                        >
                        {{ address.city }}
                      </div>
                      <div *ngIf="address.state">
                        <span class="fw-bold" style="font-size: 0.8rem"
                          >State:</span
                        >
                        {{ address.state }}
                      </div>
                      <div *ngIf="address.state">
                        <span class="fw-bold" style="font-size: 0.8rem"
                          >Postal Code:</span
                        >
                        {{ address.postalCode }}
                      </div>
                      <div>
                        <span class="fw-bold" style="font-size: 0.8rem"
                          >Street Details:</span
                        >
                        {{ address.street }}
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <hr />
            </div>

            <div class="col-12">
              <span class="fw-bold">2 - Review items</span>
              <div class="card my-3">
                <div class="card-body">
                  <!-- <h3 class="card-title m-0">Shopping Cart</h3> -->
                  <span class="float-end text-muted">Price</span>
                  <div style="clear: both"></div>
                  <hr />
                  <div
                    class="row MM_shoppingCart my-3"
                    *ngFor="let item of cartArray"
                  >
                    <div class="col-3">
                      <a class="ms-3" href="#">
                        <img
                          [src]="item.productImages[0]"
                          alt=""
                          [style.width.px]="250"
                        />
                      </a>
                    </div>

                    <div class="col-9 p-5">
                      <a href="# " class="fs-5">{{ item.productName }}</a>
                      <span class="fs-5 fw-bold float-end me-2">
                        {{
                          item.productPrice.finalPrice
                            | currency: "EGP ":"symbol"
                        }}</span
                      >
                      <div *ngIf="item.productStock <= 20" class="text-danger">
                        Only {{ item.productStock }} left in stock - order soon.
                      </div>
                      <div>Shipped from: <a href="#">Amazon.com</a></div>
                      <div>
                        Gift options not available. Gift options not available.
                        <a href="#"> Learn more </a>
                      </div>
                      <div>
                        <span class="dropdown me-2">
                          <select
                            [(ngModel)]="item.quantity"
                            (change)="updateQuantityPrice()"
                            class="btn btn-light dropdown-toggle p-1 shadow-sm"
                            id="dropdownMenuButton"
                          >
                            <option [ngValue]="1">1</option>
                            <option [ngValue]="2">2</option>
                            <option [ngValue]="3">3</option>
                            <option [ngValue]="4">4</option>
                            <option [ngValue]="5">5</option>
                          </select>
                        </span>
                        <span class="MM_itemOptions">
                          <a (click)="deleteItem(item)" style="cursor: pointer"
                            >Delete</a
                          >
                          <a href="#">Save for later</a>
                          <a href="#">Compare with similar items</a>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-12">
                      <hr />
                      <span class="float-end fs-5"
                        >Total ({{ totalQuantity }} item):
                        <span class="fw-bold">
                          {{ totalPrice | currency: "EGP ":"symbol" }}
                        </span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <p class="fw-bold mt-3">Available Payment Methods:</p>

              <div class="card-group">
                <div class="card" *ngFor="let paymentMethod of paymentMethods">
                  <img
                    [src]="paymentMethod.img"
                    class="card-img-top p-3"
                    alt="..."
                    height="120px"
                  />

                  <div class="card-footer">
                    <small class="text-muted">
                      {{ paymentMethod.paymentMethodType }}
                    </small>
                  </div>
                </div>
              </div>
              <hr />
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="row">
        <div class="col-12 MM_subTotal">
          <div class="card my-3">
            <div class="card-body">
              <button
                (click)="onConfirm()"
                [routerLink]="['/place-order']"
                class="btn bg-gradient p-1 my-2 col-12 place-order"
                [disabled]="totalQuantity === 0 || isSelectedAddress === false"
              >
                Continue to payment
              </button>

              <p class="privacy text-center">
                By placing your order, you agree to Amazon.com's
                <a href="#">privacy notice</a> and
                <a href="#">conditions of use.</a>
              </p>
              <hr />
              <div class="order-summary">
                <span class="fs-5">Order Summary</span>
                <p class="mt-3">
                  <span>Items ({{ totalQuantity }}):</span>
                  <span class="float-end" *ngIf="totalPrice > 0">
                    {{ totalPrice | currency: "EGP ":"symbol" }}
                  </span>
                </p>
                <p>
                  <span>Shipping & handling:</span>
                  <span class="float-end" *ngIf="totalPrice > 0">{{
                    shipping + handling | currency: "EGP ":"symbol"
                  }}</span>
                </p>
                <p>
                  <span>Total before tax:</span>
                  <span class="float-end" *ngIf="totalPrice > 0">{{
                    totalPrice + shipping + handling | currency: "EGP ":"symbol"
                  }}</span>
                </p>
                <p>
                  <span>14% tax to be collected:</span>
                  <span class="float-end" *ngIf="totalPrice > 0">{{
                    tax_total | currency: "EGP ":"symbol"
                  }}</span>
                </p>
                <hr />
                <p class="text-danger fs-5">
                  <span>Order total:</span>
                  <span class="float-end" *ngIf="totalPrice > 0">
                    {{ total_amount | currency: "EGP ":"symbol" }}
                  </span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
